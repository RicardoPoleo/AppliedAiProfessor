<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Class</title>
</head>
<body>
    <h1>Online Class</h1>
    <div id="statusMessage">Please wait before the class begins...</div>
    <audio id="audioPlayer" controls style="display: none;"></audio>
    <br>
    <input type="text" id="questionInput" placeholder="Ask a question..." style="display: none;">
    <button onclick="submitQuestion()" style="display: none;">Submit Question</button>
    <div id="responses"></div>

    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        var socket = io();
        var statusMessage = document.getElementById('statusMessage');
        var audioPlayer = document.getElementById('audioPlayer');
        var questionInput = document.getElementById('questionInput');
        var submitButton = document.querySelector('button');

        // Handle class start event
        socket.on('start_class', function(data) {
            statusMessage.style.display = 'none';
            audioPlayer.style.display = 'block';
            questionInput.style.display = 'inline';
            submitButton.style.display = 'inline';
            playAudio(data.audioFile);
        });

        function playAudio(filename) {
            audioPlayer.src = '/audio/' + filename;
            audioPlayer.play();
            audioPlayer.onended = function() {
                // Notify the server that this audio chunk is done
                socket.emit('audio_chunk_done');
            };
        }

        socket.on('next_audio_chunk', function(data) {
            playAudio(data.audioFile);
        });

        function submitQuestion() {
            var question = questionInput.value;
            socket.emit('submit_question', { question: question });
        }

        socket.on('receive_response', function(data) {
            var responsesDiv = document.getElementById('responses');
            var responseElem = document.createElement('p');
            responseElem.textContent = data.response;
            responsesDiv.appendChild(responseElem);
        });
    </script>
</body>
</html>
